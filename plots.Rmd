---
output:
  pdf_document: default
  html_document: default
  include: FALSE
---
```{r setup, include=FALSE}
library(tidyverse)
library(countrycode)
library(dplyr)
library(infer)
library(gridExtra)
```

```{r, include=FALSE}
cia <- readr::read_csv("https://raw.githubusercontent.com/nichollsharrisonj/Stats-Project-1/master/cia_factbook.csv")


cia <- cia %>% mutate(
  continent = countrycode(country,origin="country.name",destination="continent"),
  density = (population/area),
  internet_usage_proportion = internet_users/population
)

cia <- na.omit(cia) #OMIT ALL ROWS WITH ANY NA VALUES
```




```{r,echo=FALSE,warning=FALSE}
plot1 <- ggplot(data=cia, aes(x=internet_usage_proportion, y=life_exp_at_birth)) + 
  geom_point(aes(color = continent,size=density)) + 
  geom_abline(aes(slope = coef(lm_mod)[[2]], intercept = coef(lm_mod)[[1]], fill='Best Fit Linear Model'), size=1) +
  xlab('Internet users / population') + 
  ylab('Life Expentancy at birth') + 
  ggtitle('Figure 1')
```



```{r,echo=FALSE,warning=FALSE}
plot2 <- ggplot (data=cia, aes(x=internet_usage_proportion)) + 
  geom_histogram(bins = 12, aes(fill = continent)) + 
  xlab("Internet Usage Proportion") + 
  ylab("Count")  + ggtitle('Figure 2')
```



```{r,echo=FALSE,warning=FALSE}
plot3 <- ggplot (data=cia, aes(x=life_exp_at_birth)) + 
  geom_histogram(bins = 12, aes(color = death_rate, fill=continent)) +
  xlab("Life Expectancy at Birth - years") + 
  ylab("Count") + ggtitle('Figure 3')
```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
lm_mod <- lm(life_exp_at_birth ~ internet_usage_proportion, data = cia)
obs_slope <- lm_mod$coefficients[2]
summary(lm_mod)
plot4 <- summary(lm_mod)
```



```{r,echo=FALSE,warning=FALSE,include=FALSE}

set.seed(1009)
perm_slope <- cia %>%
   specify(life_exp_at_birth ~ internet_usage_proportion) %>%
   hypothesize(null = "independence") %>%
   generate(reps = 1000, type = "permute") %>%
   calculate(stat = "slope")

plot5 <- ggplot(data=perm_slope, aes(x=stat)) + 
   geom_histogram(bins=100) +
   geom_vline(xintercept = obs_slope, color = "#F05133") + ggtitle("Figure 5") + 
   xlim(-30,30)

```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
lm_res <- resid(lm_mod)
lm_res <- data.frame(resid = lm_res)
lm_res <- lm_res %>% mutate(internet_usage_proportion = cia$internet_usage_proportion)
plot6 <- ggplot(data=lm_res, aes(x=resid))+ 
  geom_histogram(binwidth=1, color="black") +
  xlab("Residuals") +  
  ylab("Frequency") + 
  ggtitle("Figure 6: Histogram of Residuals") + 
  xlim(-20,20)
```


```{r,echo=FALSE,warning=FALSE,include=FALSE}
plot7 <- ggplot(data=lm_res, aes(x = internet_usage_proportion, y =resid)) + geom_point(size = 1.5) + 
  xlab("Internet Usage Proportion") +  ylab("Residual")  +
  geom_hline(yintercept=0, linetype='dashed', col = 'red') +
  ggtitle("Figure 7: Internet Usage Proportion vs Residuals")
```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
set.seed(34209)
perm_ci <- cia %>% 
  specify(life_exp_at_birth ~ internet_usage_proportion) %>%  
  generate(reps = 1000, type = "bootstrap") %>% 
  calculate(stat = "slope")
plot8 <- visualize(perm_ci)
```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
alpha <- .05

#lower percentile cutoff
p_lower <- .025

#upper percentile cutoff
p_upper <- 1-(.025)

# Create a confidence interval of stat using quantiles
ci_africa <- quantile(perm_ci$stat,c(p_lower,p_upper))

```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
noafrica <- cia %>% 
  filter(continent != "Africa")

plot10 <- ggplot (data=noafrica, aes(x=internet_usage_proportion, y=life_exp_at_birth)) +
  geom_point(aes(color = continent,size=density)) + 
  geom_abline(aes(slope = coef(lm_mod_noafrica)[[2]], intercept = coef(lm_mod_noafrica)[[1]], fill='Best Fit Linear Model'), size=1) +
  xlab('Internet users / population') + 
  ylab('Life Expentancy at birth') + 
  ggtitle('Figure 10:  Africa Excluded')
```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
lm_mod_noafrica <- lm(life_exp_at_birth ~ internet_usage_proportion, data=noafrica)
obs_slope_noafrica <- lm_mod_noafrica$coefficients[2]
obs_slope_noafrica
summary(lm_mod_noafrica)

plot11 <- summary(lm_mod_noafrica)
```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
set.seed(1010)
perm_slope_noafrica <- noafrica %>%
   specify(life_exp_at_birth ~ internet_usage_proportion) %>%
   hypothesize(null = "independence") %>%
   generate(reps = 1000, type = "permute") %>%
   calculate(stat = "slope")

plot12 <- ggplot(data=perm_slope_noafrica, aes(x=stat)) + 
   geom_histogram(bins=100) +
   geom_vline(xintercept = obs_slope_noafrica,
              color = "#F05133") + 
   ggtitle("Figure 12") +
   xlim(-30,30)
```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
set.seed(34210)
perm_ci_noafrica <- noafrica %>% 
  specify(life_exp_at_birth ~ internet_usage_proportion) %>%  
  generate(reps = 1000, type = "bootstrap") %>% 
  calculate(stat = "slope")
plot13 <- visualize(perm_ci_noafrica)
```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
alpha <- .05

#lower percentile cutoff
p_lower <- .025

#upper percentile cutoff
p_upper <- 1-(.025)

# Create a confidence interval of stat using quantiles
ci_noafrica <- quantile(perm_ci_noafrica$stat,c(p_lower,p_upper))

```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
lm_res_noafrica <- resid(lm_mod_noafrica)
lm_res_noafrica <- data.frame(resid = lm_res_noafrica)
lm_res_noafrica <- lm_res_noafrica %>% mutate(internet_usage_proportion = noafrica$internet_usage_proportion)
plot15 <- ggplot(data=lm_res_noafrica, aes(x=resid)) + geom_histogram(binwidth=1, color="black") + 
  xlab("Residuals") +  ylab("Frequency") + ggtitle("Figure 15: Histogram of Residuals with Africa Excluded") + 
  xlim(-20,20)
```



```{r,echo=FALSE,warning=FALSE,include=FALSE}
plot16 <- ggplot(data=lm_res_noafrica, aes(x = internet_usage_proportion, y =resid)) + geom_point(size = 1.5) + 
  xlab("Internet Usage Proportion") +  ylab("Residual")  +
  geom_hline(yintercept=0, linetype='dashed', col = 'red') +
  ggtitle("Figure 16: Internet Usage Proportion vs Residuals with Africa Excluded")
```




# Statistics Project – Math 141

## Dashiell Ward, Gavin Rimmer, Bailee Brunsmann, Harrison Nicholls

#### CIA Factbook

## Introduction

### Hypothesis

There is a correlation between the proportion of the population using the internet and life expectancy at birth within a given nation.

$H_0: B_1 = 0$

$H_A: B_1 \ne 0$


## Approach, Declaration of Goals:

There is potentially a correlation between the variables. The average life expectancy in a country could influence internet usage and/or internet usage in a country could influence the average life expectancy.

Through our analysis, our goals are to observe how internet usage and life expectancy affect each other in different nations. Further exploration of this correlation, specifically in countries in Asia, is provided in the first background research article listed. Both background research articles provide insight about other factors that could be influencing or are influenced by the variables we chose to focus on. Economic development appears to have an important connection to technological advancements, which impacts internet accessibility and further, internet usage.
Additional research related to this subject may be found below.

Lee, Cheng-Wen, The Relationship between Internet Environment and Life Expectancy in Asia

Article explores this question specifically in Asia, with relevant take-away in emphasising the disparity between countries with advanced telecommunication services and those without in regards to their general economic development in a globalized market.

Alzaid, Ahmed, Musleh Alsulami, Komal Komal, Adel-Maraghi, Examining the Relationship between the Internet and Life Expectancy

Article explores this question Globally, finding that the economic development of a country is greatly bolstered by internet development, and has both direct and indirect impacts on the average life expectancy of its citizens.

## Data Exploration

### Dataset: 

Our dataset was Details on Countries, and it was sourced from the CIA factbook. A summary of variables may be found below.

### Variables:

#### Country - Categorical - Nominal
Countries recognized by the CIA.

#### Area - Numerical - Continuous
Land in Square km

#### Infant Mortality Rate - Numerical - Continuous
Infant mortality rate compares the number of deaths of infants under one year old in a given year per 1,000 live births in the same year. This rate is often used as an indicator of the level of health in a country.

#### Population - Numerical - Discrete
Population compares estimates from the US Bureau of the Census based on statistics from population censuses, vital statistics registration systems, or sample surveys pertaining to the recent past and on assumptions about future trends.

#### Population growth rate - Numerical - Continuous
Population growth rate compares the average annual percent change in populations, resulting from a surplus (or deficit) of births over deaths and the balance of migrants entering and leaving a country. The rate may be positive or negative.

#### Birth Rate - Numerical - Continuous
Birth rate compares the average annual number of births during a year per 1,000 persons in the population at midyear; also known as crude birth rate.

#### Death rate - Numerical - Continuous
Death rate compares the average annual number of deaths during a year per 1,000 population at midyear; also known as crude death rate.

#### Net migration rate - Numerical - Continuous
Net Migration rate compares the difference between the number of persons entering and leaving a country during the year per 1,000 persons (based on midyear population).

#### Maternal mortality rate – Numerical - Continuous
The Maternal mortality rate (MMR) is the annual number of female deaths per 100,000 live births from any cause related to or aggravated by pregnancy or its management (excluding accidental or incidental causes).

#### Life expectancy at birth – Numerical - Discrete
Life expectancy at birth compares the average number of years to be lived by a group of people born in the same year, if mortality at each age remains constant in the future. Life expectancy at birth is also a measure of overall quality of life in a country and summarizes the mortality at all ages.

#### Internet users – Numerical - Discrete
Internet users compares the number of users within a country that access the Internet. Statistics vary from country to country and may include users who access the Internet at least several times a week to those who access it only once within a period of several months.

> *Note: We also used the “countrycode” package in R to add the categorical variable of continent to our data.*

## Methods

In performing an observational study, we are limited in the viability of performing randomization tests on our data. We can find correlations in our plots using Rˆ2 and find the differences in means between different categorical groups, in our case Continents seems apt for a geopolitical analysis of the data. However, given that our sample population is itself the true population of all countries, there are no methods by which we can fabricate more samples via bootstrapping.

We noticed that when graphing life expectancy against internet usage while coloring the points by continent, almost the entire lower section of outliers was comprised of countries in Africa. We therefore theorized that internet usage only begins to correlate linearly with life expectancy at some threshold value (~65 years), which hardly any African countries meet. Based on this, we decided to see how the data would look with Africa excluded. Figures 7 and 8 reflect the results of this exploration.

Figure Six, Figure Seven, and Figure Eight: Here we have generated linear models based on Figure 1, and computed Rˆ2 of each linear model within the graphs. The greatest Rˆ2 value, and thereby the best-fit linear model, is calculated to be that of Figure Six, the graph which includes all countries, rather than Figure Seven or Figure Eight which exclude countries in the continent of Africa.

To further explore our findings, we plan to make plots of the residuals and include lines of best fit. The residuals will give us insight into the biases in our scatterplots, and allow us to determine how appropriate linear models are for comparing internet usage and life expectancy. Although excluding Africa yields a worse Rˆ2 value, it may be that the residuals form a distribution closer to normal, meaning that it is more suited to a linear model than the alternative.



```{r,echo=FALSE,warning=FALSE}
plot2 + ggtitle("Figure 1")
```

\newpage

```{r,echo=FALSE,warning=FALSE}
plot3 + ggtitle("Figure 2")
```

\newpage

```{r,echo=FALSE,warning=FALSE}
grid.arrange(plot1 + ggtitle("Figure 3"), plot10 + ggtitle("Figure 4"), ncol=2)
```

\newpage

```{r,echo=FALSE,warning=FALSE}
grid.arrange(plot6 + ggtitle("Figure 5"), plot15 + ggtitle("Figure 6"), ncol=2)
```

\newpage

```{r,echo=FALSE,warning=FALSE}
grid.arrange(plot7 + ggtitle("Figure 7"), plot16 + ggtitle("Figure 8"), ncol=2)
```

\newpage

## Figure 9

```{r,echo=FALSE,warning=FALSE}
plot4
```

## Figure 10

```{r,echo=FALSE,warning=FALSE}
plot11
```

\newpage

```{r,echo=FALSE,warning=FALSE}
grid.arrange(plot5 + ggtitle("Figure 11"), plot12 + ggtitle("Figure 12"), ncol=2)
```

\newpage

```{r,echo=FALSE,warning=FALSE}
grid.arrange(plot8 + ggtitle("Figure 13"), plot13 + ggtitle("Figure 14"), ncol=2)
```

\newpage

## Figure 15

```{r,echo=FALSE,warning=FALSE}
ci_africa
```

## Figure 16

```{r,echo=FALSE,warning=FALSE}
ci_noafrica
```

